Module 11: Automating Integration with Azure Resources

Lab: Automating the Creation of a Test Environment using PowerShell

### Exercise 1: Preparing the Azure PowerShell Environment

####   Task 1: Open the Azure PowerShell Console {#task-1-open-the-azure-powershell-console .ProcedureHeading}

<span id="List_73" class="anchor"></span>On the Start screen, click the
down arrow to view all the applications, and then click **Microsoft
Azure PowerShell**.

<span id="List_72" class="anchor"></span>Switch to the **Microsoft Azure
PowerShell** window.

####   Task 2: Import your Azure subscription by using a Publish Settings file {#task-2-import-your-azure-subscription-by-using-a-publish-settings-file .ProcedureHeading}

1.  <span id="List_71" class="anchor"></span>To get your publish
    settings file, type the following command in the console, and then
    press **Enter**:

Get-AzurePublishSettingsFile

<span id="List_70" class="anchor"></span>In the **Internet Explorer**
tab that opens, perform the following steps:

<span id="List_69" class="anchor"></span>Enter the email address of your
Microsoft account.

<span id="List_68" class="anchor"></span>Click Continue.

<span id="List_67" class="anchor"></span>Enter the password for your
Microsoft account.

<span id="List_66" class="anchor"></span>Click **Sign In**.

<span id="List_65" class="anchor"></span>At the bottom of the Internet
Explorer window, click the arrow that is on the right side of the
**Save** button, and then click **Save As** in the download dialog box.

<span id="List_64" class="anchor"></span>In the **Save As** dialog box
that displays, perform the following steps:

a.  <span id="List_63" class="anchor"></span>Go to the AllFiles
    (F):\\Mod11\\Labfiles folder.

<span id="List_62" class="anchor"></span>In the **File Name** box, type
**20532**.

<span id="List_61" class="anchor"></span>In the **Save as type** box,
ensure that the **PUBLISHSETTINGS File** option is selected.

<span id="List_60" class="anchor"></span>Click **Save**.

<span id="List_59" class="anchor"></span>Close Internet Explorer.

<span id="List_58" class="anchor"></span>Switch to the **Microsoft Azure
PowerShell** application.

<span id="List_57" class="anchor"></span>To import your publish settings
file, type the following command in the console, and then press Enter:

Import-AzurePublishSettingsFile
F:\\Mod11\\Labfiles\\20532.publishsettings

<span id="List_56" class="anchor"></span>To view your account details,
type the following command in the console, and then press Enter:

Get-AzureAccount

> ![](media/image1.wmf) **Note:** If you have multiple Azure
> subscriptions, you can use **Select-AzureSubscription** to select the
> appropriate subscription.
>
> If your Azure subscription is provided by a Learning Partner, it might
> be an auto-generated account without any details. In such a case, this
> command will return an empty result.

**Results**: After completing this exercise, you will have set up a
development environment to use Windows PowerShell for Azure service
automation.

### Exercise 2: Using Windows PowerShell to create and access a Website instance

####   Task 1: Create a new Website instance by using Windows PowerShell {#task-1-create-a-new-website-instance-by-using-windows-powershell .ProcedureHeading}

1.  <span id="List_52" class="anchor"></span>To create a new Website,
    type the following command in the console by providing the unique
    name selected for your Website, and then press Enter:

New-AzureWebsite [Unique Name]

> ![](media/image1.wmf) **Note:** You might get an error message
> notifying you that your Website’s name is not unique. If this occurs,
> select a new name until your Website is created.

<span id="List_51" class="anchor"></span>To view a list of your
Websites, type the following command in the console, and then press
Enter:

Get-AzureWebsite

<span id="List_50" class="anchor"></span>To get the details for your new
Website, type the following command in the console by providing the
unique name selected for your Website, and then press Enter:

Get-AzureWebsite –Name [Unique Name]

<span id="List_49" class="anchor"></span>Record the **hostname** value
from the list of key-value pairs that are generated by the previous
command.

<span id="List_48" class="anchor"></span>To view the new Website in
Internet Explorer, type the following command in the console, and then
press Enter:

explorer “http://[Host Name]”

<span id="List_47" class="anchor"></span>Verify that the new Website is
running.

<span id="List_46" class="anchor"></span>Close Internet Explorer.

<span id="List_45" class="anchor"></span>Switch to the **Microsoft Azure
PowerShell** console window.

####   Task 2: Remove a Website instance by using Windows PowerShell {#task-2-remove-a-website-instance-by-using-windows-powershell .ProcedureHeading}

1.  <span id="List_44" class="anchor"></span>To stop your new Website,
    type the following command in the console by providing the unique
    name selected for your Website, and then press Enter:

Stop-AzureWebsite –Name [Unique Name]

<span id="List_43" class="anchor"></span>To view the list of your
Websites, type the following command in the console, and then press
Enter:

Get-AzureWebsite

<span id="List_42" class="anchor"></span>To remove your new Website,
type the following command in the console by providing the unique name
selected for your Website, and then press Enter:

Remove-AzureWebsite –Name [Unique Name]

<span id="List_41" class="anchor"></span>Type **Y** to indicate that you
want to remove the Website, and then press Enter.

<span id="List_40" class="anchor"></span>To verify that your Website is
removed, type the following command in the console by providing the
unique name selected for your Website, and then press Enter. The result
should be empty:

<span id="List_39" class="anchor"></span>Get-AzureWebsite –Name [Unique
Name]

**Results**: After completing this exercise, you will have used Windows
PowerShell to manage instances of an Azure service.

### Exercise 3: Using a resource template to create multiple preconfigured resources

####   Task 1: Switch to the Azure Resource Manager PowerShell Modules {#task-1-switch-to-the-azure-resource-manager-powershell-modules .ProcedureHeading}

<span id="List_36" class="anchor"></span>To switch modules, type the
following command in the console, and then press Enter:

<span id="List_35" class="anchor"></span>Switch-AzureMode
AzureResourceManager

####   Task 2: Import your Azure subscription by using Azure Active Directory {#task-2-import-your-azure-subscription-by-using-azure-active-directory .ProcedureHeading}

1.  <span id="List_34" class="anchor"></span>To sign in to Azure, type
    the following command in the console, and then press Enter:

Add-AzureAccount

<span id="List_33" class="anchor"></span>In the **Sign in to Windows
Azure** dialog box, perform the following steps:

a.  <span id="List_32" class="anchor"></span>Enter the email address of
    your Microsoft account..

<span id="List_31" class="anchor"></span>Click Continue.

<span id="List_30" class="anchor"></span>Enter the password for your
Microsoft account..

<span id="List_29" class="anchor"></span>Click **Sign In**.

<span id="List_28" class="anchor"></span>To view your account details,
type the following command in the console, and then press Enter:

Get-AzureAccount

> ![](media/image1.wmf) **Note:** If you have multiple Azure
> subscriptions, you can use **Select-AzureSubscription** to select the
> appropriate subscription.

####   Task 3: Create a resource group by using Windows PowerShell {#task-3-create-a-resource-group-by-using-windows-powershell .ProcedureHeading}

1.  <span id="List_26" class="anchor"></span>To view the description of
    the resource group template, type the following command in the
    console, and then press Enter:

Get-AzureResourceGroupGalleryTemplate -Identity
Microsoft.WebSiteSQLDatabase.0.2.0-preview

<span id="List_25" class="anchor"></span>To create a new instance of a
resource group from the template, type the following command in the
console, and then press Enter:

New-AzureResourceGroup –Name rga20532 –Location “West
Us” -GalleryTemplateIdentity Microsoft.WebSiteSQLDatabase.0.2.0-preview

<span id="List_24" class="anchor"></span>To provide the parameters for
the template, perform the following steps:

a.  <span id="List_23" class="anchor"></span>For the **siteName**
    prompt, provide the value **rs20532[*Your Name Here*]**, and press
    Enter.

<span id="List_22" class="anchor"></span>For the **hostingPlanName**
prompt, provide the value **rp20532[*Your Name Here*]**, and then press
Enter.

<span id="List_21" class="anchor"></span>For the **siteLocation**
prompt, provide the value **West US**, and then press Enter.

<span id="List_20" class="anchor"></span>For the **serverName** prompt,
provide the value **rv20532[*Your Name Here*]**, and then press Enter.

<span id="List_19" class="anchor"></span>For the **serverLocation**
prompt, provide the value **West US**, and then press Enter.

<span id="List_18" class="anchor"></span>For the **administratorLogin**
prompt, provide the value **testuser,** and then press Enter.

<span id="List_17" class="anchor"></span>For the
**administratorLoginPassword** prompt, provide the value
**TestPa\$\$w0rd**, and press Enter.

<span id="List_16" class="anchor"></span>For the **databaseName**
prompt, provide the value **rd20532[*Your Name Here*]**, and press
Enter.

> ![](media/image1.wmf) **Note:** Wait for the provisioning process to
> complete. Status messages will be displayed periodically and the final
> message with the details will be displayed when provisioning is
> complete.

<span id="List_15" class="anchor"></span>To get the details of your new
resource group, type the following command in the console by providing
the unique name selected for your Website, and then press Enter:

Get-AzureResourceGroup –ResourceGroupName rga20532

<span id="List_14" class="anchor"></span>To get the details of your new
Website, type the following command in the console by providing the
unique name selected for your Website, and then press Enter:

Get-AzureResource -Name rs20532[Your Name Here] -ResourceGroupName
rga20532 -ResourceType "Microsoft.Web/sites" -ApiVersion 2014-04-01

<span id="List_13" class="anchor"></span>Record the single value in the
**hostNames** array from the JSON data generated by the previous
command.

<span id="List_12" class="anchor"></span>To view the new Website in
Internet Explorer, type the following command in the console, and then
press Enter:

explorer “http://[Host Name]”

<span id="List_11" class="anchor"></span>Verify that the new Website is
running.

<span id="List_10" class="anchor"></span>Close Internet Explorer.

<span id="List_9" class="anchor"></span>Switch to the **Microsoft Azure
PowerShell** console window.

####   Task 4: Remove the resource group by using Windows PowerShell {#task-4-remove-the-resource-group-by-using-windows-powershell .ProcedureHeading}

1.  <span id="List_8" class="anchor"></span>To remove your new resource
    group, type the following command in the console, and then press
    Enter:

Remove-AzureResourceGroup –Name rga20532

<span id="List_7" class="anchor"></span>Type **Y** to indicate that you
want to remove the Website, and then press Enter.

> ![](media/image1.wmf) **Note:** Because removing a resource group
> involves removing multiple resources, this process can take 5 to 15
> minutes on average.

<span id="List_4" class="anchor"></span>Close the **Microsoft Azure
PowerShell** console window.

**Results**: After completing this exercise, you will have used Azure to
interact with the Resource Manager, resource groups, and resource group
templates.

### \

©2014 Microsoft Corporation. All rights reserved.  The text in this
document is available under the [Creative Commons Attribution 3.0
License](https://creativecommons.org/licenses/by/3.0/legalcode),
additional terms may apply.  All other content contained in this
document (including, without limitation, trademarks, logos, images,
etc.) are ***not*** included within the Creative Commons license grant. 
This document does not provide you with any legal rights to any
intellectual property in any Microsoft product. You may copy and use
this document for your internal, reference purposes. 

This document is provided "as-is." Information and views expressed in
this document, including URL and other Internet Web site references, may
change without notice. You bear the risk of using it. Some examples are
for illustration only and are fictitious. No real association is
intended or inferred. Microsoft makes no warranties, express or implied,
with respect to the information provided here. 
